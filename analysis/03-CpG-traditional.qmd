---
title: "CpG Traditional Analysis"
author: "Paolo Cozzi"
date: today
toc: true
number-sections: true
cache: true
format:
  html:
    code-line-numbers: true
    html-math-method: katex
    df-print: paged
    code-fold: true
    toc-depth: 5
    embed-resources: true  # Embed all resources directly into the HTML file
knitr:
  opts_chunk:
    dpi: 100
editor: source
---

```{r setup, output=FALSE}
library(here)
library(targets)
library(ggplot2)

# where I can find artifacts
store_path <- here::here("_targets")
```

I've just read the *bedMethyl* files using `targets`, and then I've filtered them
in order to focus on the regions of interest, which are the CpG islands with
a certain buffer around them. Load data about `valid_coverage` and `percent_modified`
for each samples from `5mC_5hmC` model and with `modkit --preset traditional`
(should be only `CpG` sites): This is not the full dataset, but a subsample of
10,000 rows per sample (to speed up the analysis).

```{r load-data}
tar_load(coverage_data, store = store_path)
summary(coverage_data)
```

Let's plot the distribution of `valid_coverage` accross all samples:

```{r plot-valid-coverage}
ggplot2::ggplot(coverage_data, aes(y = valid_coverage, x = sample, fill = breed)) +
  ggplot2::geom_boxplot() +
  ggplot2::scale_y_log10(limits = c(NA, 100)) +
  ggplot2::labs(
    title = "Distribution of Valid Coverage in CpG Buffer Regions",
    y = "Valid Coverage (log10 scale)",
  ) +
  ggplot2::theme_minimal()
```

Plot the distribution of percent modified methylation:

```{r plot-percent-modified}
ggplot(coverage_data, aes(y = percent_modified, x = sample, fill = breed)) +
  ggplot2::geom_boxplot() +
  ggplot2::labs(
    title = "Distribution of Percent Modified Methylation",
    y = "Modified Methylation (%)"
  ) +
  theme_minimal()
```
